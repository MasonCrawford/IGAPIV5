using Data.Dto;
using Newtonsoft.Json.Linq;
using TradingService.Interfaces;
using Xunit;

namespace TradeLoop.test;

public class ProgramTests
{
    private readonly ITradingChartService _tradingChartService;
    private readonly List<PricesDto> _prices = new();

    public ProgramTests(ITradingChartService tradingChartService)
    {
        _tradingChartService = tradingChartService;
        var jsonString =
            "{\"prices\":[{\"snapshotTime\":\"2021/12/1104:50:00\",\"snapshotTimeUTC\":\"2021-12-10T17:50:00\",\"openPrice\":{\"bid\":0.71765,\"ask\":0.71774,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71758,\"ask\":0.71764,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71768,\"ask\":0.71776,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71755,\"ask\":0.71761,\"lastTraded\":null},\"lastTradedVolume\":180},{\"snapshotTime\":\"2021/12/1104:55:00\",\"snapshotTimeUTC\":\"2021-12-10T17:55:00\",\"openPrice\":{\"bid\":0.71757,\"ask\":0.71763,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71753,\"ask\":0.71759,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71757,\"ask\":0.71765,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71746,\"ask\":0.71754,\"lastTraded\":null},\"lastTradedVolume\":220},{\"snapshotTime\":\"2021/12/1105:00:00\",\"snapshotTimeUTC\":\"2021-12-10T18:00:00\",\"openPrice\":{\"bid\":0.71754,\"ask\":0.71760,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71788,\"ask\":0.71794,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71806,\"ask\":0.71814,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71751,\"ask\":0.71758,\"lastTraded\":null},\"lastTradedVolume\":424},{\"snapshotTime\":\"2021/12/1105:05:00\",\"snapshotTimeUTC\":\"2021-12-10T18:05:00\",\"openPrice\":{\"bid\":0.71784,\"ask\":0.71790,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71771,\"ask\":0.71777,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71784,\"ask\":0.71790,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71764,\"ask\":0.71772,\"lastTraded\":null},\"lastTradedVolume\":286},{\"snapshotTime\":\"2021/12/1105:10:00\",\"snapshotTimeUTC\":\"2021-12-10T18:10:00\",\"openPrice\":{\"bid\":0.71772,\"ask\":0.71778,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71751,\"ask\":0.71760,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71772,\"ask\":0.71779,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71750,\"ask\":0.71758,\"lastTraded\":null},\"lastTradedVolume\":202},{\"snapshotTime\":\"2021/12/1105:15:00\",\"snapshotTimeUTC\":\"2021-12-10T18:15:00\",\"openPrice\":{\"bid\":0.71750,\"ask\":0.71759,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71747,\"ask\":0.71756,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71757,\"ask\":0.71765,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71745,\"ask\":0.71752,\"lastTraded\":null},\"lastTradedVolume\":171},{\"snapshotTime\":\"2021/12/1105:20:00\",\"snapshotTimeUTC\":\"2021-12-10T18:20:00\",\"openPrice\":{\"bid\":0.71746,\"ask\":0.71755,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71742,\"ask\":0.71748,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71748,\"ask\":0.71756,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71737,\"ask\":0.71745,\"lastTraded\":null},\"lastTradedVolume\":151},{\"snapshotTime\":\"2021/12/1105:25:00\",\"snapshotTimeUTC\":\"2021-12-10T18:25:00\",\"openPrice\":{\"bid\":0.71743,\"ask\":0.71749,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71742,\"ask\":0.71748,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71746,\"ask\":0.71754,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71740,\"ask\":0.71747,\"lastTraded\":null},\"lastTradedVolume\":138},{\"snapshotTime\":\"2021/12/1105:30:00\",\"snapshotTimeUTC\":\"2021-12-10T18:30:00\",\"openPrice\":{\"bid\":0.71741,\"ask\":0.71750,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71725,\"ask\":0.71731,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71742,\"ask\":0.71750,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71724,\"ask\":0.71731,\"lastTraded\":null},\"lastTradedVolume\":169},{\"snapshotTime\":\"2021/12/1105:35:00\",\"snapshotTimeUTC\":\"2021-12-10T18:35:00\",\"openPrice\":{\"bid\":0.71726,\"ask\":0.71732,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71725,\"ask\":0.71734,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71729,\"ask\":0.71737,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71720,\"ask\":0.71728,\"lastTraded\":null},\"lastTradedVolume\":153},{\"snapshotTime\":\"2021/12/1105:40:00\",\"snapshotTimeUTC\":\"2021-12-10T18:40:00\",\"openPrice\":{\"bid\":0.71726,\"ask\":0.71735,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71716,\"ask\":0.71725,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71728,\"ask\":0.71736,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71715,\"ask\":0.71723,\"lastTraded\":null},\"lastTradedVolume\":118},{\"snapshotTime\":\"2021/12/1105:45:00\",\"snapshotTimeUTC\":\"2021-12-10T18:45:00\",\"openPrice\":{\"bid\":0.71715,\"ask\":0.71724,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71696,\"ask\":0.71705,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71718,\"ask\":0.71725,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71691,\"ask\":0.71698,\"lastTraded\":null},\"lastTradedVolume\":187},{\"snapshotTime\":\"2021/12/1105:50:00\",\"snapshotTimeUTC\":\"2021-12-10T18:50:00\",\"openPrice\":{\"bid\":0.71695,\"ask\":0.71704,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71701,\"ask\":0.71710,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71709,\"ask\":0.71717,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71695,\"ask\":0.71703,\"lastTraded\":null},\"lastTradedVolume\":178},{\"snapshotTime\":\"2021/12/1105:55:00\",\"snapshotTimeUTC\":\"2021-12-10T18:55:00\",\"openPrice\":{\"bid\":0.71700,\"ask\":0.71709,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71709,\"ask\":0.71715,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71710,\"ask\":0.71717,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71695,\"ask\":0.71703,\"lastTraded\":null},\"lastTradedVolume\":179},{\"snapshotTime\":\"2021/12/1106:00:00\",\"snapshotTimeUTC\":\"2021-12-10T19:00:00\",\"openPrice\":{\"bid\":0.71708,\"ask\":0.71714,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71706,\"ask\":0.71715,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71718,\"ask\":0.71726,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71704,\"ask\":0.71713,\"lastTraded\":null},\"lastTradedVolume\":197},{\"snapshotTime\":\"2021/12/1106:05:00\",\"snapshotTimeUTC\":\"2021-12-10T19:05:00\",\"openPrice\":{\"bid\":0.71708,\"ask\":0.71714,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71700,\"ask\":0.71709,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71708,\"ask\":0.71716,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71699,\"ask\":0.71707,\"lastTraded\":null},\"lastTradedVolume\":134},{\"snapshotTime\":\"2021/12/1106:10:00\",\"snapshotTimeUTC\":\"2021-12-10T19:10:00\",\"openPrice\":{\"bid\":0.71699,\"ask\":0.71708,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71701,\"ask\":0.71710,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71704,\"ask\":0.71711,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71698,\"ask\":0.71705,\"lastTraded\":null},\"lastTradedVolume\":186},{\"snapshotTime\":\"2021/12/1106:15:00\",\"snapshotTimeUTC\":\"2021-12-10T19:15:00\",\"openPrice\":{\"bid\":0.71702,\"ask\":0.71711,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71701,\"ask\":0.71710,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71703,\"ask\":0.71711,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71692,\"ask\":0.71701,\"lastTraded\":null},\"lastTradedVolume\":138},{\"snapshotTime\":\"2021/12/1106:20:00\",\"snapshotTimeUTC\":\"2021-12-10T19:20:00\",\"openPrice\":{\"bid\":0.71703,\"ask\":0.71709,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71700,\"ask\":0.71709,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71703,\"ask\":0.71710,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71699,\"ask\":0.71707,\"lastTraded\":null},\"lastTradedVolume\":127},{\"snapshotTime\":\"2021/12/1106:25:00\",\"snapshotTimeUTC\":\"2021-12-10T19:25:00\",\"openPrice\":{\"bid\":0.71702,\"ask\":0.71708,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71707,\"ask\":0.71713,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71707,\"ask\":0.71714,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71694,\"ask\":0.71700,\"lastTraded\":null},\"lastTradedVolume\":137},{\"snapshotTime\":\"2021/12/1106:30:00\",\"snapshotTimeUTC\":\"2021-12-10T19:30:00\",\"openPrice\":{\"bid\":0.71708,\"ask\":0.71714,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71696,\"ask\":0.71705,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71713,\"ask\":0.71719,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71695,\"ask\":0.71702,\"lastTraded\":null},\"lastTradedVolume\":184},{\"snapshotTime\":\"2021/12/1106:35:00\",\"snapshotTimeUTC\":\"2021-12-10T19:35:00\",\"openPrice\":{\"bid\":0.71697,\"ask\":0.71706,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71722,\"ask\":0.71728,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71723,\"ask\":0.71730,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71696,\"ask\":0.71705,\"lastTraded\":null},\"lastTradedVolume\":189},{\"snapshotTime\":\"2021/12/1106:40:00\",\"snapshotTimeUTC\":\"2021-12-10T19:40:00\",\"openPrice\":{\"bid\":0.71721,\"ask\":0.71727,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71718,\"ask\":0.71724,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71723,\"ask\":0.71731,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71716,\"ask\":0.71723,\"lastTraded\":null},\"lastTradedVolume\":148},{\"snapshotTime\":\"2021/12/1106:45:00\",\"snapshotTimeUTC\":\"2021-12-10T19:45:00\",\"openPrice\":{\"bid\":0.71717,\"ask\":0.71723,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71713,\"ask\":0.71719,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71723,\"ask\":0.71730,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71711,\"ask\":0.71718,\"lastTraded\":null},\"lastTradedVolume\":199},{\"snapshotTime\":\"2021/12/1106:50:00\",\"snapshotTimeUTC\":\"2021-12-10T19:50:00\",\"openPrice\":{\"bid\":0.71712,\"ask\":0.71718,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71707,\"ask\":0.71716,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71712,\"ask\":0.71720,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71700,\"ask\":0.71708,\"lastTraded\":null},\"lastTradedVolume\":148},{\"snapshotTime\":\"2021/12/1106:55:00\",\"snapshotTimeUTC\":\"2021-12-10T19:55:00\",\"openPrice\":{\"bid\":0.71706,\"ask\":0.71715,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71681,\"ask\":0.71690,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71707,\"ask\":0.71716,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71680,\"ask\":0.71686,\"lastTraded\":null},\"lastTradedVolume\":342},{\"snapshotTime\":\"2021/12/1107:00:00\",\"snapshotTimeUTC\":\"2021-12-10T20:00:00\",\"openPrice\":{\"bid\":0.71680,\"ask\":0.71689,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71668,\"ask\":0.71674,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71690,\"ask\":0.71696,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71668,\"ask\":0.71674,\"lastTraded\":null},\"lastTradedVolume\":321},{\"snapshotTime\":\"2021/12/1107:05:00\",\"snapshotTimeUTC\":\"2021-12-10T20:05:00\",\"openPrice\":{\"bid\":0.71666,\"ask\":0.71675,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71672,\"ask\":0.71678,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71674,\"ask\":0.71681,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71663,\"ask\":0.71669,\"lastTraded\":null},\"lastTradedVolume\":153},{\"snapshotTime\":\"2021/12/1107:10:00\",\"snapshotTimeUTC\":\"2021-12-10T20:10:00\",\"openPrice\":{\"bid\":0.71674,\"ask\":0.71680,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71681,\"ask\":0.71690,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71685,\"ask\":0.71692,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71673,\"ask\":0.71679,\"lastTraded\":null},\"lastTradedVolume\":163},{\"snapshotTime\":\"2021/12/1107:15:00\",\"snapshotTimeUTC\":\"2021-12-10T20:15:00\",\"openPrice\":{\"bid\":0.71680,\"ask\":0.71689,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71677,\"ask\":0.71683,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71689,\"ask\":0.71695,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71674,\"ask\":0.71680,\"lastTraded\":null},\"lastTradedVolume\":144},{\"snapshotTime\":\"2021/12/1107:20:00\",\"snapshotTimeUTC\":\"2021-12-10T20:20:00\",\"openPrice\":{\"bid\":0.71676,\"ask\":0.71685,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71680,\"ask\":0.71689,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71684,\"ask\":0.71693,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71675,\"ask\":0.71683,\"lastTraded\":null},\"lastTradedVolume\":142},{\"snapshotTime\":\"2021/12/1107:25:00\",\"snapshotTimeUTC\":\"2021-12-10T20:25:00\",\"openPrice\":{\"bid\":0.71681,\"ask\":0.71687,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71682,\"ask\":0.71688,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71683,\"ask\":0.71690,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71671,\"ask\":0.71677,\"lastTraded\":null},\"lastTradedVolume\":133},{\"snapshotTime\":\"2021/12/1107:30:00\",\"snapshotTimeUTC\":\"2021-12-10T20:30:00\",\"openPrice\":{\"bid\":0.71683,\"ask\":0.71689,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71686,\"ask\":0.71695,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71689,\"ask\":0.71695,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71675,\"ask\":0.71683,\"lastTraded\":null},\"lastTradedVolume\":150},{\"snapshotTime\":\"2021/12/1107:35:00\",\"snapshotTimeUTC\":\"2021-12-10T20:35:00\",\"openPrice\":{\"bid\":0.71685,\"ask\":0.71694,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71684,\"ask\":0.71690,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71692,\"ask\":0.71698,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71680,\"ask\":0.71688,\"lastTraded\":null},\"lastTradedVolume\":184},{\"snapshotTime\":\"2021/12/1107:40:00\",\"snapshotTimeUTC\":\"2021-12-10T20:40:00\",\"openPrice\":{\"bid\":0.71682,\"ask\":0.71691,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71689,\"ask\":0.71695,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71704,\"ask\":0.71712,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71682,\"ask\":0.71691,\"lastTraded\":null},\"lastTradedVolume\":243},{\"snapshotTime\":\"2021/12/1107:45:00\",\"snapshotTimeUTC\":\"2021-12-10T20:45:00\",\"openPrice\":{\"bid\":0.71688,\"ask\":0.71697,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71695,\"ask\":0.71704,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71697,\"ask\":0.71706,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71684,\"ask\":0.71691,\"lastTraded\":null},\"lastTradedVolume\":213},{\"snapshotTime\":\"2021/12/1107:50:00\",\"snapshotTimeUTC\":\"2021-12-10T20:50:00\",\"openPrice\":{\"bid\":0.71699,\"ask\":0.71705,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71692,\"ask\":0.71701,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71700,\"ask\":0.71708,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71687,\"ask\":0.71696,\"lastTraded\":null},\"lastTradedVolume\":264},{\"snapshotTime\":\"2021/12/1107:55:00\",\"snapshotTimeUTC\":\"2021-12-10T20:55:00\",\"openPrice\":{\"bid\":0.71691,\"ask\":0.71700,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71718,\"ask\":0.71727,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71719,\"ask\":0.71728,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71691,\"ask\":0.71699,\"lastTraded\":null},\"lastTradedVolume\":280},{\"snapshotTime\":\"2021/12/1108:00:00\",\"snapshotTimeUTC\":\"2021-12-10T21:00:00\",\"openPrice\":{\"bid\":0.71714,\"ask\":0.71723,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71692,\"ask\":0.71701,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71715,\"ask\":0.71724,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71686,\"ask\":0.71695,\"lastTraded\":null},\"lastTradedVolume\":387},{\"snapshotTime\":\"2021/12/1108:05:00\",\"snapshotTimeUTC\":\"2021-12-10T21:05:00\",\"openPrice\":{\"bid\":0.71693,\"ask\":0.71702,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71691,\"ask\":0.71700,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71696,\"ask\":0.71705,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71689,\"ask\":0.71698,\"lastTraded\":null},\"lastTradedVolume\":131},{\"snapshotTime\":\"2021/12/1108:10:00\",\"snapshotTimeUTC\":\"2021-12-10T21:10:00\",\"openPrice\":{\"bid\":0.71692,\"ask\":0.71701,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71703,\"ask\":0.71712,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71714,\"ask\":0.71723,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71691,\"ask\":0.71700,\"lastTraded\":null},\"lastTradedVolume\":202},{\"snapshotTime\":\"2021/12/1108:15:00\",\"snapshotTimeUTC\":\"2021-12-10T21:15:00\",\"openPrice\":{\"bid\":0.71704,\"ask\":0.71713,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71703,\"ask\":0.71712,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71709,\"ask\":0.71718,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71698,\"ask\":0.71707,\"lastTraded\":null},\"lastTradedVolume\":166},{\"snapshotTime\":\"2021/12/1108:20:00\",\"snapshotTimeUTC\":\"2021-12-10T21:20:00\",\"openPrice\":{\"bid\":0.71702,\"ask\":0.71711,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71704,\"ask\":0.71713,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71707,\"ask\":0.71716,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71697,\"ask\":0.71706,\"lastTraded\":null},\"lastTradedVolume\":186},{\"snapshotTime\":\"2021/12/1108:25:00\",\"snapshotTimeUTC\":\"2021-12-10T21:25:00\",\"openPrice\":{\"bid\":0.71705,\"ask\":0.71714,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71706,\"ask\":0.71715,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71719,\"ask\":0.71728,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71698,\"ask\":0.71707,\"lastTraded\":null},\"lastTradedVolume\":310},{\"snapshotTime\":\"2021/12/1108:30:00\",\"snapshotTimeUTC\":\"2021-12-10T21:30:00\",\"openPrice\":{\"bid\":0.71707,\"ask\":0.71716,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71714,\"ask\":0.71723,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71722,\"ask\":0.71731,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71704,\"ask\":0.71713,\"lastTraded\":null},\"lastTradedVolume\":160},{\"snapshotTime\":\"2021/12/1108:35:00\",\"snapshotTimeUTC\":\"2021-12-10T21:35:00\",\"openPrice\":{\"bid\":0.71715,\"ask\":0.71724,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71725,\"ask\":0.71734,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71727,\"ask\":0.71736,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71711,\"ask\":0.71720,\"lastTraded\":null},\"lastTradedVolume\":164},{\"snapshotTime\":\"2021/12/1108:40:00\",\"snapshotTimeUTC\":\"2021-12-10T21:40:00\",\"openPrice\":{\"bid\":0.71724,\"ask\":0.71733,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71724,\"ask\":0.71733,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71732,\"ask\":0.71741,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71719,\"ask\":0.71728,\"lastTraded\":null},\"lastTradedVolume\":187},{\"snapshotTime\":\"2021/12/1108:45:00\",\"snapshotTimeUTC\":\"2021-12-10T21:45:00\",\"openPrice\":{\"bid\":0.71725,\"ask\":0.71734,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71719,\"ask\":0.71728,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71728,\"ask\":0.71737,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71713,\"ask\":0.71722,\"lastTraded\":null},\"lastTradedVolume\":192},{\"snapshotTime\":\"2021/12/1108:50:00\",\"snapshotTimeUTC\":\"2021-12-10T21:50:00\",\"openPrice\":{\"bid\":0.71718,\"ask\":0.71727,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71718,\"ask\":0.71727,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71723,\"ask\":0.71732,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71709,\"ask\":0.71718,\"lastTraded\":null},\"lastTradedVolume\":116},{\"snapshotTime\":\"2021/12/1108:55:00\",\"snapshotTimeUTC\":\"2021-12-10T21:55:00\",\"openPrice\":{\"bid\":0.71717,\"ask\":0.71726,\"lastTraded\":null},\"closePrice\":{\"bid\":0.71673,\"ask\":0.71753,\"lastTraded\":null},\"highPrice\":{\"bid\":0.71737,\"ask\":0.71773,\"lastTraded\":null},\"lowPrice\":{\"bid\":0.71652,\"ask\":0.71722,\"lastTraded\":null},\"lastTradedVolume\":399}]}";
        var test = JObject.Parse(jsonString);
        var prices = test["prices"];
        foreach (var price in prices)
        {
            _prices.Add(new PricesDto
            {
                ClosePrice = new PriceDto
                {
                    Ask = (decimal) price["closePrice"]["ask"],
                    Bid = (decimal) price["closePrice"]["bid"],
                    LastTraded = 1
                },
                HighPrice = new PriceDto
                {
                    Ask = (decimal) price["highPrice"]["ask"],
                    Bid = (decimal) price["highPrice"]["bid"],
                    LastTraded = 1
                },
                LowPrice = new PriceDto
                {
                    Ask = (decimal) price["lowPrice"]["ask"],
                    Bid = (decimal) price["lowPrice"]["bid"],
                    LastTraded = 1
                },
                OpenPrice = new PriceDto
                {
                    Ask = (decimal) price["openPrice"]["ask"],
                    Bid = (decimal) price["openPrice"]["bid"],
                    LastTraded = 1
                }
            });
            _prices.Last().MovingAverage = _tradingChartService.CalculateMovingAverage(_prices);
        }
    }

    [Fact]
    public async Task prices_lenght_is_50()
    {
        Assert.True(_prices.Count == 50);
    }
}